# (opensloth) ➜  opensloth git:(dev/improve-usage) ✗ code train.sh
# (opensloth) ➜  opensloth git:(dev/improve-usage) ✗ os os train data/grpo_final_test --method grpo --gpus 0,1 -m ./hf-models/unsloth/Qwen3-0.6B-bnb-4bit --yes --use-tmux --grpo-max-tokens 2048 --help
# Usage: os [OPTIONS] COMMAND [ARGS]...
# Try 'os --help' for help.
# ╭─ Error ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
# │ No such command 'os'.                                                                                                                                                                                                                                                                                                                                          │
# ╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
# (opensloth) ➜  opensloth git:(dev/improve-usage) ✗  train data/grpo_final_test --method grpo --gpus 0,1 -m ./hf-models/unsloth/Qwen3-0.6B-bnb-4bit --yes --use-tmux --grpo-max-tokens 2048 
# (opensloth) ➜  opensloth git:(dev/improve-usage) ✗ os train data/grpo_final_test --method grpo --gpus 0,1 -m ./hf-models/unsloth/Qwen3-0.6B-bnb-4bit --yes --use-tmux --grpo-max-tokens 2048 --help
                                                                                                                                                                                                                                                                                                                                                                  
#  Usage: os train [OPTIONS] DATASET                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                  
#  🚀 Train a model with pre-processed dataset                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                  
#  **Examples:**                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                  
#  • **Basic training:**                                                                                                                                                                                                                                                                                                                                            
#    os train data/my_dataset                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                  
#  • **Multi-GPU:**                                                                                                                                                                                                                                                                                                                                                 
#    os train data/my_dataset --gpus 0,1,2,3                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                  
#  • **Quick test:**                                                                                                                                                                                                                                                                                                                                                
#    os train data/my_dataset --preset quick                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                  
#  • **Custom settings:**                                                                                                                                                                                                                                                                                                                                           
#    os train data/my_dataset --model unsloth/Qwen2.5-7B-Instruct --epochs 5 --batch-size 2                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                  
#  **💡 Tips:**                                                                                                                                                                                                                                                                                                                                                     
#  • Model auto-detected from dataset if not specified                                                                                                                                                                                                                                                                                                              
#  • Use `os list-presets` to see available presets                                                                                                                                                                                                                                                                                                                 
#  • Use `--dry-run` to preview configuration                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                  
# ╭─ Arguments ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
# │ *    dataset      TEXT  📊 Path to processed dataset directory [default: None] [required]                                                                                                                                                                                                                                                                      │
# ╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯
# ╭─ Options ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╮
# │ --method           -M                         TEXT     🎯 Training method: sft | dpo | grpo [default: sft]                                                                                                                                                                                                                                                     │
# │ --model            -m                         TEXT     🤖 Model (auto-detect from dataset if not specified) [default: None]                                                                                                                                                                                                                                    │
# │ --output           -o                         TEXT     💾 Output directory [default: None]                                                                                                                                                                                                                                                                     │
# │ --gpus             -g                         TEXT     🔧 GPU indices (e.g. '0' or '0,1,2,3') [default: 0]                                                                                                                                                                                                                                                     │
# │ --epochs                                      INTEGER  🔄 Number of epochs [default: None]                                                                                                                                                                                                                                                                     │
# │ --max-steps                                   INTEGER  ⏰ Max training steps [default: None]                                                                                                                                                                                                                                                                   │
# │ --batch-size                                  INTEGER  📦 Batch size per GPU [default: None]                                                                                                                                                                                                                                                                   │
# │ --lr                                          FLOAT    📚 Learning rate [default: None]                                                                                                                                                                                                                                                                        │
# │ --max-seq-length                              INTEGER  📏 Max sequence length [default: None]                                                                                                                                                                                                                                                                  │
# │ --4bit                 --no-4bit                       🔢 4-bit quantization [default: 4bit]                                                                                                                                                                                                                                                                   │
# │ --full-finetune                                        🎯 Full parameter training                                                                                                                                                                                                                                                                              │
# │ --lora-r                                      INTEGER  🎯 LoRA rank [default: None]                                                                                                                                                                                                                                                                            │
# │ --lora-alpha                                  INTEGER  🎯 LoRA alpha [default: None]                                                                                                                                                                                                                                                                           │
# │ --grpo-task-type                              TEXT     🎯 GRPO task type: math | code | general | reasoning [default: None]                                                                                                                                                                                                                                    │
# │ --grpo-group-size                             INTEGER  👥 Number of responses per prompt [default: None]                                                                                                                                                                                                                                                       │
# │ --grpo-temp                                   FLOAT    🌡️ GRPO sampling temperature [default: None]                                                                                                                                                                                                                                                             │
# │ --grpo-max-tokens                             INTEGER  📝 Max new tokens for GRPO generation [default: None]                                                                                                                                                                                                                                                   │
# │ --grpo-rewards                                TEXT     🏆 Comma-separated reward function names [default: None]                                                                                                                                                                                                                                                │
# │ --preset                                      TEXT     ⚙️ Use preset configuration [default: None]                                                                                                                                                                                                                                                              │
# │ --dry-run                                              👀 Show config without training                                                                                                                                                                                                                                                                         │
# │ --yes              -y                                  ✅ Skip confirmations                                                                                                                                                                                                                                                                                   │
# │ --use-tmux             --no-tmux                       🖥️ Launch multi-GPU training in a tmux session (one window per GPU) [default: no-tmux]                                                                                                                                                                                                                   │
# │ --tmux-session                                TEXT     📛 tmux session name (default: os_train_<timestamp>) [default: None]                                                                                                                                                                                                                                    │
# │ --tmux-auto-kill       --no-tmux-auto-kill             ☠️ Auto-kill existing session if present [default: no-tmux-auto-kill]                                                                                                                                                                                                                                    │
# │ --help                                                 Show this message and exit.                                                                                                                                                                                                                                                                             │
# ╰────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────╯

# (opensloth) ➜  opensloth git:(dev/improve-usage) ✗ 
os prepare-data --method grpo --dataset "open-r1/DAPO-Math-17k-Processed" --split "en" --samples 10000 --model "unsloth/Qwen2.5-7B-Instruct" --output data/grpo_final_test --yes  -f

os train data/grpo_final_test --method grpo --gpus 0,1,2,3 -m hf-models/unsloth/Qwen3-4B-Base-bnb-4bit/ --yes --use-tmux --grpo-max-tokens 2048 --grpo-group-size 8 --batch-size 8 --task math